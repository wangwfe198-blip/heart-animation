<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>蓝色粒子心 + 逼真烟花</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: radial-gradient(circle at center, #0b0f1a, #000);
}
canvas { display: block; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
window.onresize = () => {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
};

// ===== 心粒子生成 =====
const heartParticles = [];
const heartScaleBase = 0.7;
function generateHeartParticles(count=5000){
  heartParticles.length = 0;
  for(let i=0;i<count;i++){
    let t=Math.random()*Math.PI*2;
    let u=Math.random();
    let x=16*Math.pow(Math.sin(t),3)*(1-u*0.5);
    let y=(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))*(1-u*0.5);
    heartParticles.push({
      x:x*20*heartScaleBase,
      y:-y*20*heartScaleBase,
      size:Math.random()*1.5+0.5,
      alpha:Math.random()*0.8+0.2,
      color:"#4DB8FF"
    });
  }
}
generateHeartParticles();

// ===== 烟花类 =====
let fireworks = [];
class Firework {
  constructor(){
    this.x = Math.random()*w;
    this.y = h;
    this.color = `hsl(${Math.random()*360}, 80%, 60%)`;
    this.exploded = false;
    this.particles = [];
    this.vy = -(Math.random()*7+5);
    this.vx = (Math.random()-0.5)*2;
  }
  update(){
    if(!this.exploded){
      this.x += this.vx;
      this.y += this.vy;
      this.vy += 0.15;
      if(this.vy >= 0){
        this.exploded = true;
        const n = 80 + Math.random()*50;
        for(let i=0;i<n;i++){
          const angle = Math.random()*Math.PI*2;
          const speed = Math.random()*4+1;
          this.particles.push({
            x:this.x, y:this.y,
            vx:Math.cos(angle)*speed,
            vy:Math.sin(angle)*speed,
            alpha:1,
            size:Math.random()*2+1
          });
        }
      }
    }else{
      this.particles.forEach(p=>{
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.05;
        p.alpha -= 0.02;
      });
      this.particles = this.particles.filter(p=>p.alpha>0);
    }
  }
  draw(){
    if(!this.exploded){
      ctx.fillStyle=this.color;
      ctx.beginPath();
      ctx.arc(this.x,this.y,2,0,Math.PI*2);
      ctx.fill();
    }else{
      this.particles.forEach(p=>{
        const grad=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.size*2);
        grad.addColorStop(0,this.color);
        grad.addColorStop(1,"transparent");
        ctx.globalAlpha=p.alpha;
        ctx.fillStyle=grad;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size*2,0,Math.PI*2);
        ctx.fill();
      });
    }
  }
}

// ===== 心跳扩散（四向呼吸） =====
let t=0;

// ===== 动画主循环 =====
function animate(){
  requestAnimationFrame(animate);
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,w,h);

  t+=0.05;
  const pulse = Math.sin(t*2); // 呼吸节奏
  const spread = 8 * pulse;    // 扩散幅度

  // 绘制粒子心（轻微扩散效果）
  heartParticles.forEach(p=>{
    const offsetX = p.x + (p.x / 150) * spread; 
    const offsetY = p.y + (p.y / 150) * spread; 
    ctx.globalAlpha = p.alpha;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(offsetX + w/2, offsetY + h/2, p.size, 0, Math.PI*2);
    ctx.fill();
  });

  // 烟花生成与更新
  if(Math.random() < 0.03) fireworks.push(new Firework());
  fireworks.forEach(f=>{ f.update(); f.draw(); });
  fireworks = fireworks.filter(f => !f.exploded || f.particles.length>0);
}

animate();
</script>
</body>
</html>
